<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniTools AI | Enterprise</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');

        :root {
            --bg: #020617;
            --sidebar: #0f172a;
            --accent: #06b6d4;
            --glass: rgba(30, 41, 59, 0.7);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        body { margin: 0; background: var(--bg); color: white; display: flex; height: 100vh; overflow: hidden; }

        /* AUTH SCREEN */
        #authScreen {
            position: fixed; inset: 0; background: var(--bg); z-index: 9999;
            display: flex; align-items: center; justify-content: center;
        }
        .auth-card {
            background: var(--sidebar); padding: 40px; border-radius: 24px;
            width: 400px; border: 1px solid var(--border); text-align: center;
        }
        .auth-card input {
            width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px;
            background: #1e293b; border: 1px solid var(--border); color: white;
        }
        .auth-btn {
            width: 100%; padding: 12px; border-radius: 12px; border: none;
            background: var(--accent); color: black; font-weight: 800; cursor: pointer; margin-top: 10px;
        }

        /* MAIN LAYOUT */
        .sidebar { width: 300px; background: var(--sidebar); padding: 25px; display: flex; flex-direction: column; border-right: 1px solid var(--border); }
        .main { flex: 1; display: flex; flex-direction: column; background: radial-gradient(circle at top right, #1e293b, #020617); }

        /* API KEY VAULT */
        .key-vault { margin-top: 20px; flex: 1; overflow-y: auto; }
        .key-item {
            padding: 10px; background: rgba(255,255,255,0.05); border-radius: 10px;
            margin-bottom: 8px; font-size: 0.8rem; cursor: pointer; border: 1px solid transparent;
        }
        .key-item.active { border-color: var(--accent); background: rgba(6, 182, 212, 0.1); }

        /* CHAT AREA */
        header { padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .chat-box { flex: 1; overflow-y: auto; padding: 40px; display: flex; flex-direction: column; gap: 20px; }
        .bubble { max-width: 80%; padding: 15px 20px; border-radius: 20px; line-height: 1.6; }
        .user { align-self: flex-end; background: var(--accent); color: black; }
        .bot { align-self: flex-start; background: var(--glass); border: 1px solid var(--border); }

        /* INPUT */
        .input-area { padding: 30px 10%; position: relative; }
        .input-container {
            background: var(--glass); backdrop-filter: blur(15px);
            padding: 15px; border-radius: 20px; display: flex; gap: 15px; border: 1px solid var(--border);
        }
        textarea { flex: 1; background: transparent; border: none; color: white; resize: none; outline: none; }

        /* MODALS */
        .modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            z-index: 1000; align-items: center; justify-content: center;
        }
        .modal-content {
            background: #1e293b; padding: 30px; border-radius: 24px; width: 500px; border: 1px solid var(--border);
        }
    </style>
</head>
<body>

<div id="authScreen">
    <div class="auth-card">
        <h1 style="color:var(--accent)">OmniTools</h1>
        <p id="authTitle">Sign in to your AI Workspace</p>
        <input type="email" id="authEmail" placeholder="Email Address">
        <input type="password" id="authPass" placeholder="Password">
        <button class="auth-btn" onclick="handleAuth()">Continue</button>
        <p style="font-size: 0.8rem; margin-top: 15px; cursor: pointer; color: #94a3b8;" onclick="toggleAuthMode()">
            Need an account? <span style="color:var(--accent)">Register</span>
        </p>
    </div>
</div>

<div class="sidebar">
    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 30px;">
        <i data-lucide="shield-check" style="color:var(--accent)"></i>
        <span style="font-weight: 800; font-size: 1.2rem;">OMNIPRO</span>
    </div>

    <button class="auth-btn" style="background:rgba(255,255,255,0.1); color:white;" onclick="openProfile()">
        <i data-lucide="user"></i> My Account
    </button>

    <div class="key-vault">
        <label style="font-size: 0.7rem; color: #64748b; text-transform: uppercase;">My API Vault</label>
        <div id="vaultList">
            </div>
        <button onclick="openKeyModal()" style="width:100%; background:none; border: 1px dashed #475569; color:#94a3b8; padding:10px; border-radius:10px; margin-top:10px; cursor:pointer;">
            + Add New Key
        </button>
    </div>

    <button onclick="logout()" style="background:none; border:none; color:#ef4444; cursor:pointer; margin-top: 20px;">
        <i data-lucide="log-out"></i> Logout
    </button>
</div>

<div class="main">
    <header>
        <div>
            <span id="activeModelLabel" style="font-size: 0.8rem; color: var(--accent);">Active: DeepSeek R1</span>
        </div>
        <div id="userNameDisplay">User Profile</div>
    </header>

    <div class="chat-box" id="chat">
        <div class="bubble bot">Welcome to your secure workspace. Your keys and history are now synced to your account.</div>
    </div>

    <div class="input-area">
        <div class="input-container">
            <textarea id="msg" placeholder="Type a message..." rows="1"></textarea>
            <button class="auth-btn" style="width:auto; margin:0;" onclick="sendMessage()">
                <i data-lucide="send"></i>
            </button>
        </div>
    </div>
</div>

<div id="keyModal" class="modal">
    <div class="modal-content">
        <h3>Add API Key to Vault</h3>
        <input type="text" id="keyNickname" placeholder="Key Nickname (e.g. My Free Key)">
        <input type="password" id="keyVal" placeholder="OpenRouter API Key">
        <select id="keyModel">
            <option value="deepseek/deepseek-r1:free">DeepSeek R1 (Free)</option>
            <option value="google/gemini-2.0-flash-exp:free">Gemini 2.0 Flash</option>
            <option value="meta-llama/llama-3.3-70b-instruct:free">Llama 3.3 70B</option>
        </select>
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="auth-btn" style="background:#334155; color:white;" onclick="closeModals()">Cancel</button>
            <button class="auth-btn" onclick="saveKeyToVault()">Save to Cloud</button>
        </div>
    </div>
</div>

<script>
    // --- FIREBASE CONFIGURATION ---
    // PASTE YOUR FIREBASE CONFIG HERE TO MAKE IT WORK PERMANENTLY
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_ID",
        appId: "YOUR_APP_ID"
    };
    
    // Initialize Firebase (Only if config is provided, otherwise fallback to LocalStorage for demo)
    let db, auth;
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        auth = firebase.auth();
    } catch(e) { console.log("Firebase not configured, using local mode."); }

    lucide.createIcons();

    let isRegister = false;
    let currentUser = null;
    let apiVault = JSON.parse(localStorage.getItem("apiVault") || "[]");
    let activeKeyIndex = 0;

    // --- AUTH LOGIC ---
    function toggleAuthMode() {
        isRegister = !isRegister;
        document.getElementById("authTitle").innerText = isRegister ? "Create your Account" : "Sign in to your AI Workspace";
    }

    function handleAuth() {
        const email = document.getElementById("authEmail").value;
        const pass = document.getElementById("authPass").value;

        if(!email || !pass) return alert("Fill all fields");

        // Simple Local Simulation for Demo (Replace with Firebase auth.signInWithEmailAndPassword)
        currentUser = { email: email, name: email.split('@')[0] };
        localStorage.setItem("session", JSON.stringify(currentUser));
        document.getElementById("authScreen").style.display = "none";
        document.getElementById("userNameDisplay").innerText = currentUser.name;
        renderVault();
    }

    function logout() {
        localStorage.removeItem("session");
        location.reload();
    }

    // --- VAULT LOGIC ---
    function openKeyModal() { document.getElementById("keyModal").style.display = "flex"; }
    function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }

    function saveKeyToVault() {
        const nickname = document.getElementById("keyNickname").value;
        const key = document.getElementById("keyVal").value;
        const model = document.getElementById("keyModel").value;

        if(!key) return alert("API Key is required");

        apiVault.push({ nickname, key, model });
        localStorage.setItem("apiVault", JSON.stringify(apiVault));
        
        // If Firebase is active, save to cloud:
        // db.collection("users").doc(currentUser.uid).update({ vault: apiVault });

        renderVault();
        closeModals();
    }

    function renderVault() {
        const list = document.getElementById("vaultList");
        list.innerHTML = "";
        apiVault.forEach((item, index) => {
            const div = document.createElement("div");
            div.className = `key-item ${activeKeyIndex === index ? 'active' : ''}`;
            div.innerHTML = `<strong>${item.nickname || 'Unnamed Key'}</strong><br>${item.model}`;
            div.onclick = () => {
                activeKeyIndex = index;
                document.getElementById("activeModelLabel").innerText = "Active: " + item.model;
                renderVault();
            };
            list.appendChild(div);
        });
    }

    // --- CHAT LOGIC ---
    async function sendMessage() {
        const msg = document.getElementById("msg").value;
        if(!msg || apiVault.length === 0) return alert("Type a message and ensure a key is selected!");

        addBubble(msg, 'user');
        document.getElementById("msg").value = "";

        const currentSettings = apiVault[activeKeyIndex];

        try {
            const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${currentSettings.key}`
                },
                body: JSON.stringify({
                    model: currentSettings.model,
                    messages: [{role: "user", content: msg}]
                })
            });
            const data = await res.json();
            addBubble(data.choices[0].message.content, 'bot');
        } catch(e) {
            addBubble("Error: API Key failed or connection lost.", 'bot');
        }
    }

    function addBubble(text, role) {
        const chat = document.getElementById("chat");
        const div = document.createElement("div");
        div.className = `bubble ${role}`;
        div.innerText = text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }

    window.onload = () => {
        const session = localStorage.getItem("session");
        if(session) {
            currentUser = JSON.parse(session);
            document.getElementById("authScreen").style.display = "none";
            document.getElementById("userNameDisplay").innerText = currentUser.name;
            renderVault();
        }
    };
</script>

</body>
</html>
