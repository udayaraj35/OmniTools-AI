<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniTools AI | Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-main: #0f172a;
            --bg-side: #020617;
            --accent: #00d2ff;
            --accent-hover: #0099cc;
            --text-main: #f8fafc;
            --glass: rgba(30, 41, 59, 0.7);
        }

        * { box-sizing: border-box; transition: all 0.2s ease; }
        body { 
            margin: 0; font-family: 'Inter', -apple-system, sans-serif; 
            background: var(--bg-main); color: var(--text-main);
            display: flex; height: 100vh; overflow: hidden;
        }

        /* Sidebar Styling */
        .sidebar {
            width: 280px; background: var(--bg-side);
            padding: 24px; display: flex; flex-direction: column;
            border-right: 1px solid rgba(255,255,255,0.05);
        }
        .sidebar h2 { 
            font-size: 1.5rem; font-weight: 800; color: var(--accent);
            margin-bottom: 30px; display: flex; align-items: center; gap: 10px;
        }

        .nav-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.1);
            color: white; padding: 12px; border-radius: 12px;
            cursor: pointer; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;
            font-weight: 500;
        }
        .nav-btn:hover { background: rgba(255,255,255,0.05); border-color: var(--accent); }

        /* Main Chat Area */
        .main { flex: 1; display: flex; flex-direction: column; position: relative; }
        
        header {
            padding: 15px 30px; background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px); display: flex; justify-content: space-between;
            align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .chat-container {
            flex: 1; overflow-y: auto; padding: 30px;
            scroll-behavior: smooth; display: flex; flex-direction: column;
        }

        /* Bubbles */
        .bubble {
            max-width: 80%; padding: 14px 18px; border-radius: 18px;
            margin-bottom: 15px; line-height: 1.5; font-size: 0.95rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .user {
            align-self: flex-end; background: var(--accent); color: #000;
            border-bottom-right-radius: 4px; font-weight: 500;
        }
        .bot {
            align-self: flex-start; background: var(--glass); color: #e2e8f0;
            border-bottom-left-radius: 4px; border: 1px solid rgba(255,255,255,0.05);
        }

        /* Input Bar */
        .input-wrapper {
            padding: 20px 40px 40px; background: linear-gradient(transparent, var(--bg-main));
        }
        .input-bar {
            background: var(--glass); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px; padding: 10px 20px; display: flex; align-items: center;
            gap: 15px; backdrop-filter: blur(15px);
        }
        textarea {
            flex: 1; background: transparent; border: none; color: white;
            resize: none; outline: none; padding: 10px 0; font-size: 1rem;
        }
        .icon-btn {
            background: transparent; border: none; color: #94a3b8; cursor: pointer;
            padding: 5px; border-radius: 50%;
        }
        .icon-btn:hover { color: var(--accent); transform: scale(1.1); }
        .send-btn {
            background: var(--accent); color: black; border: none;
            padding: 10px 20px; border-radius: 12px; font-weight: bold; cursor: pointer;
        }
        .send-btn:hover { background: var(--accent-hover); box-shadow: 0 0 15px rgba(0,210,255,0.4); }

        /* Modal Customization */
        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            display: none; justify-content: center; align-items: center; z-index: 100;
        }
        .modal-box {
            background: #1e293b; color: white; padding: 30px;
            border-radius: 24px; width: 450px; border: 1px solid rgba(255,255,255,0.1);
        }
        .modal-box input, .modal-box textarea {
            background: #0f172a; border: 1px solid #334155; color: white;
            border-radius: 8px; padding: 10px; margin-bottom: 15px;
        }

        /* Utility */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2><i data-lucide="zap"></i> OmniTools</h2>
    <button class="nav-btn" onclick="openSettings()"><i data-lucide="settings"></i> Settings</button>
    <button class="nav-btn" onclick="clearHistory()"><i data-lucide="trash-2"></i> Clear History</button>
    
    <div style="margin-top:20px;">
        <p style="font-size: 0.7rem; color: #64748b; text-transform: uppercase; letter-spacing: 1px;">Recent Models</p>
        <div id="modelHistory"></div>
    </div>

    <div style="margin-top:auto; color: #475569; font-size: 0.75rem;">
        Powered by OpenRouter AI
    </div>
</div>

<div class="main">
    <header>
        <div id="userDisplay" style="font-weight: 600; color: var(--accent);"></div>
        <div style="display: flex; gap: 15px; color: #64748b;">
            <i data-lucide="shield-check"></i>
            <i data-lucide="cpu"></i>
        </div>
    </header>

    <div class="chat-container" id="chat">
        <div class="bubble bot">Welcome! I am your advanced AI assistant. How can I help you today?</div>
    </div>

    <div class="input-wrapper">
        <div class="input-bar">
            <label for="fileInput" class="icon-btn">
                <i data-lucide="paperclip"></i>
            </label>
            <input type="file" id="fileInput" accept=".pdf" style="display:none">
            
            <textarea id="msg" rows="1" placeholder="Type your prompt here..." oninput="autoResize(this)"></textarea>
            
            <button class="send-btn" onclick="sendMessage()">
                <i data-lucide="send"></i>
            </button>
        </div>
    </div>
</div>

<div class="modal" id="settingsModal">
    <div class="modal-box">
        <h3 style="margin-top:0;">AI Configuration</h3>
        
        <label>API Key</label>
        <input type="password" id="apiKey" placeholder="sk-or-...">

        <label>Model ID</label>
        <input type="text" id="modelInput" placeholder="deepseek/deepseek-r1:free">

        <div style="display:flex; justify-content: space-between;">
            <label>Temperature</label>
            <span id="tempValue" style="color:var(--accent)">0.7</span>
        </div>
        <input type="range" min="0" max="1" step="0.1" id="temperature" style="width:100%">

        <label>System Instructions</label>
        <textarea id="systemPrompt" rows="3"></textarea>

        <div style="display:flex; gap: 10px; margin-top:15px;">
            <button onclick="closeSettings()" style="flex:1; background:transparent; color:white; border:none; cursor:pointer;">Cancel</button>
            <button onclick="saveSettings()" style="flex:2; background:var(--accent); border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:bold;">Save & Apply</button>
        </div>
    </div>
</div>

<script>
    // Initialize Lucide Icons
    lucide.createIcons();

    let user = localStorage.getItem("user") || prompt("What should I call you?");
    localStorage.setItem("user", user);
    document.getElementById("userDisplay").innerText = "Ready, " + user;

    function autoResize(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
    }

    function addBubble(text, type) {
        let div = document.createElement("div");
        div.className = "bubble " + type;
        div.innerHTML = text.replace(/\n/g, '<br>');
        document.getElementById("chat").appendChild(div);
        document.getElementById("chat").scrollTop = 999999;
    }

    function openSettings(){
        settingsModal.style.display="flex";
        let s=JSON.parse(localStorage.getItem("settings")||"{}");
        apiKey.value=s.key||"";
        modelInput.value=s.model||"deepseek/deepseek-r1:free";
        temperature.value=s.temp||0.7;
        tempValue.innerText=temperature.value;
        systemPrompt.value=s.prompt||"You are a helpful AI assistant.";
    }

    temperature.oninput=()=>tempValue.innerText=temperature.value;
    function closeSettings(){settingsModal.style.display="none";}

    function saveSettings(){
        let s={
            key:apiKey.value,
            model:modelInput.value||"deepseek/deepseek-r1:free",
            temp:parseFloat(temperature.value),
            prompt:systemPrompt.value
        };
        localStorage.setItem("settings",JSON.stringify(s));
        closeSettings();
        updateModelHistory(s.model);
    }

    function updateModelHistory(model){
        let history=JSON.parse(localStorage.getItem("modelHistory")||"[]");
        if(!history.includes(model)){
            history.unshift(model);
            if(history.length>3)history.pop();
            localStorage.setItem("modelHistory",JSON.stringify(history));
        }
        renderHistory();
    }

    function renderHistory(){
        let history=JSON.parse(localStorage.getItem("modelHistory")||"[]");
        let container = document.getElementById("modelHistory");
        container.innerHTML = "";
        history.forEach(m=>{
            let item = document.createElement("div");
            item.style.cssText = "font-size:11px; padding:8px; background:rgba(255,255,255,0.03); margin-top:5px; border-radius:6px; color:#94a3b8; border: 1px solid rgba(255,255,255,0.05)";
            item.innerText = m;
            container.appendChild(item);
        });
    }
    renderHistory();

    function clearHistory(){
        localStorage.removeItem("modelHistory");
        renderHistory();
        document.getElementById("chat").innerHTML = '<div class="bubble bot">History cleared. How can I help?</div>';
    }

    async function extractPDFText(file){
        let text="";
        let reader=new FileReader();
        return new Promise(resolve=>{
            reader.onload=async function(){
                let pdf=await pdfjsLib.getDocument({data:new Uint8Array(this.result)}).promise;
                for(let i=1;i<=pdf.numPages;i++){
                    let page=await pdf.getPage(i);
                    let content=await page.getTextContent();
                    content.items.forEach(item=>text+=item.str+" ");
                }
                resolve(text);
            };
            reader.readAsArrayBuffer(file);
        });
    }

    async function sendMessage(){
        let msgInput = document.getElementById("msg");
        let message = msgInput.value;
        if(!message && !fileInput.files.length) return;
        
        addBubble(message || "Processing document...", "user");
        msgInput.value = "";
        msgInput.style.height = 'auto';

        let s = JSON.parse(localStorage.getItem("settings")||"{}");
        if(!s.key){ alert("Please enter your API key in Settings"); return; }

        let finalMessage = message;
        if(fileInput.files.length){
            let pdfText = await extractPDFText(fileInput.files[0]);
            finalMessage += "\n\n[Attached PDF Content]:\n" + pdfText;
            fileInput.value = "";
        }

        try {
            let res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + s.key
                },
                body: JSON.stringify({
                    model: s.model,
                    temperature: s.temp,
                    messages: [
                        {role: "system", content: s.prompt},
                        {role: "user", content: finalMessage}
                    ]
                })
            });

            let data = await res.json();
            let reply = data.choices?.[0]?.message?.content || "API Error: No response found.";
            addBubble(reply, "bot");

        } catch(e) {
            addBubble("Connection Error. Check your internet or API key.", "bot");
        }
    }
</script>
</body>
</html>
